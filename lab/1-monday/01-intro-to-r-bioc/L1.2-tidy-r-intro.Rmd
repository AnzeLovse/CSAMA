---
title: "Lab 1.2: Introduction to tidy _R_"
output:
  BiocStyle::html_document:
    toc: true
vignette: >
  % \VignetteIndexEntry{Lab 1.2: Introduction to tidy R}
  % \VignetteEngine{knitr::rmarkdown}
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
```

```{r setup, echo=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

Original Authors: Martin Morgan<br />
Presenting Authors: [Martin Morgan][]</br >
Date: 22 July, 2019</br >
Back: [Monday labs](lab-1-intro-to-r-bioc.html)

[Martin Morgan]: mailto: Martin.Morgan@RoswellPark.org
[Lori Shepherd]: mailto: Lori.Shepherd@RoswellPark.org

**Objective**: Gain confidence working with 'tidy' R commands and data
  structures.
  
**Lessons learned**:

- Basic data input
- Working with data.frames
- Subsetting, including working with NA values and factors
- Summary statistics
- Visualization using base R and [ggplot2][]

# Introduction to the tidyverse

The 'tidyverse' is a a recent approach to working with data in
_R_. The basic principle is that data is often best represented in
'long-form' data.frames, with data transformations implemented with a
few central functions. 

Start by loading the tidyverse of related packages

```{r, message = FALSE}
library(tidyverse)
```

Read the BRFSS data into a `tibble` (data.frame) using `read_csv()`;
this function is similar to `read.csv()` but standardized the argument
naming convention.

```{r echo=TRUE, eval=FALSE}
fname <- file.choose()   ## BRFSS-subset.csv
stopifnot(file.exists(fname))
brfss <- read_csv(fname)
```
<!--
```{r echo=FALSE}
fname <- "BRFSS-subset.csv"
stopifnot(file.exists(fname))
brfss <- read_csv(fname)
```
-->

Note that by default character values were _not_ interpreted as
factors, that the display is more informative (the class of each
column is indicated under the title), and only a 'preview' of all the
data is displayed.

```{r}
brfss
```

A `tibble()` can be manipulated like a data.frame, but usually
operations in the tidyverse are 'piped' using the `%>%` symbol from
one representation to another. We start with some clean-up using the
`mutate()` function to update or add individual columns.

```{r}
brfss %>% mutate( Sex = factor(Sex), Year = factor(Year) )
brfss <- brfss %>% mutate( Sex = factor(Sex), Year = factor(Year) )
```

One common operation is to `filter()` rows to those containing only
certain values, and to `select()` a subset of columns.

```{r}
brfss %>% filter(Sex == "Female", Year == "1990") %>% 
    select(Age, Weight, Height)
```

Another common operation is to `group_by()` one or more columns, and
`summarize()` data in other columns, e.g.,

```{r}
brfss %>% group_by(Sex, Year) %>% 
    summarize(
        AveAge = mean(Age, na.rm=TRUE), AveWeight = mean(Weight, na.rm=TRUE)
    )
```

Note that the output of each pipe is itself a tibble, so that the
output can be further transformed using tidyverse functions.

The main features of 'tidy' data are

1. Standard representation as a long-format data.frame-like `tibble()`

2. Restricted vocabulary of core functions -- `mutate()`, `filter()`,
   `select()`, `group_by()`, `summarize()`, ... These functions are
   'isomorphic', meaning that the return value is the same type (a
   tibble!) as the first argument of the function.
   
3. Short 'pipes' summarizing data transformation steps.

As an **exercise**, revisit case study 2.1, ALL Phenotype Data, using
a tidyverse approach to data exploration.

# End matter

## Session Info

```{r}
sessionInfo()
```

## Acknowledgements

Research reported in this tutorial was supported by the National Human
Genome Research Institute and the National Cancer Institute of the
National Institutes of Health under award numbers U41HG004059 and
U24CA180996.

This project has received funding from the European Research Council
(ERC) under the European Union's Horizon 2020 research and innovation
programme (grant agreement number 633974)
